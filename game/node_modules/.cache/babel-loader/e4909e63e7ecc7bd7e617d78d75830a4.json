{"ast":null,"code":"var _jsxFileName = \"/var/www/html/chat-app/game/src/game/DialogBox.js\",\n    _s = $RefreshSig$();\n\nimport { useCallback, useEffect, useState } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { useForm } from \"react-hook-form\";\nimport dungAudio from \"./assets/audio/dung.mp3\";\nimport saiAudio from \"./assets/audio/sai.wav\"; // Images\n\nimport dialogBorderBox from \"./assets/images/dialog_borderbox.png\"; // Components\n\nimport Message from \"./Message\";\nimport ReactAudioPlayer from \"react-audio-player\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst useStyles = makeStyles(theme => ({\n  dialogWindow: _ref => {\n    let {\n      width,\n      height,\n      multiplier\n    } = _ref;\n    const messageBoxHeight = Math.ceil(height / 3.5 * multiplier);\n    return {\n      imageRendering: \"pixelated\",\n      fontFamily: '\"Press Start 2P\"',\n      textTransform: \"uppercase\",\n      backgroundColor: \"#e2b27e\",\n      border: \"solid\",\n      borderImage: `url(\"${dialogBorderBox}\") 6 / ${6 * multiplier}px ${6 * multiplier}px ${6 * multiplier}px ${6 * multiplier}px stretch`,\n      padding: `${8 * multiplier}px`,\n      position: \"absolute\",\n      top: `${Math.ceil(height * multiplier - (messageBoxHeight + messageBoxHeight * 0.1) - 50)}px`,\n      width: `${Math.ceil(width * 0.8 * multiplier)}px`,\n      left: \"50%\",\n      transform: \"translate(-50%, 0%)\",\n      minHeight: `${messageBoxHeight}px`\n    };\n  },\n  dialogTitle: _ref2 => {\n    let {\n      multiplier\n    } = _ref2;\n    return {\n      fontSize: `${8 * multiplier}px`,\n      marginBottom: `${6 * multiplier}px`,\n      fontWeight: \"bold\"\n    };\n  },\n  dialogFooter: _ref3 => {\n    let {\n      multiplier\n    } = _ref3;\n    return {\n      fontSize: `${8 * multiplier}px`,\n      cursor: \"pointer\",\n      textAlign: \"end\",\n      position: \"absolute\",\n      right: `${6 * multiplier}px`,\n      bottom: `${6 * multiplier}px`\n    };\n  },\n  buttonSubmit: _ref4 => {\n    let {\n      multiplier\n    } = _ref4;\n    return {\n      fontSize: `${8 * multiplier}px`,\n      marginLeft: \"20px\"\n    };\n  },\n  input: _ref5 => {\n    let {\n      multiplier\n    } = _ref5;\n    return {\n      fontSize: `${8 * multiplier}px`\n    };\n  }\n}));\n\nconst DialogBox = _ref6 => {\n  _s();\n\n  let {\n    messages,\n    characterName,\n    onDone,\n    gameSize,\n    setHeroCoins,\n    question,\n    setHeroHealthStates,\n    setQuestionIndex,\n    heroHealthStates\n  } = _ref6;\n  const {\n    register,\n    handleSubmit\n  } = useForm();\n  const {\n    width,\n    height,\n    multiplier\n  } = gameSize;\n  const [currentMessage, setCurrentMessage] = useState(0);\n  const [messageEnded, setMessageEnded] = useState(false);\n  const [forceShowFullMessage, setForceShowFullMessage] = useState(false);\n  const [results, setResults] = useState(\"\");\n  const [urlAudio, setUrlAudio] = useState(\"\");\n  const classes = useStyles({\n    width,\n    height,\n    multiplier\n  });\n\n  const onSubmit = data => {\n    const input = data.textInput.toLowerCase();\n\n    if (input === messages[0].answer) {\n      setHeroCoins(pre => pre + 5);\n      setUrlAudio(dungAudio);\n      setResults(\"Đúng rồi\");\n    } else {\n      setUrlAudio(saiAudio);\n      setHeroCoins(pre => pre - 5);\n      setResults(\"Sai rồi\");\n    }\n  };\n\n  const handleClick = useCallback(() => {\n    if (characterName === question) {\n      if (messageEnded) {\n        setMessageEnded(false);\n        setForceShowFullMessage(false);\n\n        if (currentMessage < messages.length - 1) {\n          setCurrentMessage(currentMessage + 1);\n        } else {\n          setCurrentMessage(0);\n          onDone();\n          setQuestionIndex(pre => pre + 1);\n        }\n      } else {\n        setMessageEnded(true);\n        setForceShowFullMessage(true);\n      }\n    } else {\n      onDone();\n    }\n  }, [currentMessage, messageEnded, messages.length, onDone]);\n  useEffect(() => {\n    const handleKeyPressed = e => {\n      if ([\"Space\", \"Escape\"].includes(e.code)) {\n        handleClick();\n      }\n    };\n\n    window.addEventListener(\"keydown\", handleKeyPressed);\n    return () => window.removeEventListener(\"keydown\", handleKeyPressed);\n  }, [handleClick]);\n  useEffect(() => {\n    if (characterName !== question) {\n      setHeroHealthStates(heroHealthStates.filter((item, i) => i !== heroHealthStates.length - 1));\n      setUrlAudio(saiAudio);\n    } else {\n      setHeroCoins(pre => pre + 5); // setUrlAudio(dungAudio);\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    className: classes.dialogWindow,\n    children: [/*#__PURE__*/_jsxDEV(ReactAudioPlayer, {\n      src: urlAudio,\n      autoPlay: true,\n      controls: true,\n      style: {\n        display: \"none\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 143,\n      columnNumber: 7\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: classes.dialogTitle,\n      children: \"Qu\\u1EA3 g\\xEC?\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 149,\n      columnNumber: 7\n    }, this), characterName === question ? /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [/*#__PURE__*/_jsxDEV(Message, {\n        action: messages[currentMessage].action,\n        message: messages[currentMessage].message,\n        multiplier: multiplier,\n        forceShowFullMessage: forceShowFullMessage,\n        onMessageEnded: () => {\n          setMessageEnded(true);\n        }\n      }, currentMessage, false, {\n        fileName: _jsxFileName,\n        lineNumber: 152,\n        columnNumber: 11\n      }, this), !results ? /*#__PURE__*/_jsxDEV(\"form\", {\n        onSubmit: handleSubmit(onSubmit),\n        children: /*#__PURE__*/_jsxDEV(\"div\", {\n          style: {\n            marginTop: \"30px\"\n          },\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"text\",\n            ...register(\"textInput\"),\n            placeholder: \"Nh\\u1EADp t\\u1EEB v\\u1EEBa nghe \\u0111\\u01B0\\u1EE3c\",\n            className: classes.input\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 165,\n            columnNumber: 17\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            type: \"submit\",\n            className: classes.buttonSubmit,\n            children: \"Ki\\u1EC3m tra\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 171,\n            columnNumber: 17\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 164,\n          columnNumber: 15\n        }, this)\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 163,\n        columnNumber: 13\n      }, this) : /*#__PURE__*/_jsxDEV(\"div\", {\n        children: results\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 177,\n        columnNumber: 13\n      }, this)]\n    }, void 0, true) : /*#__PURE__*/_jsxDEV(\"div\", {\n      children: \"B\\u1EA1n \\u0111\\xE3 ch\\u1ECDn sai\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 181,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      onClick: handleClick,\n      className: classes.dialogFooter,\n      children: \"B\\u1ECF qua\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 183,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 142,\n    columnNumber: 5\n  }, this);\n};\n\n_s(DialogBox, \"bXmNOzOCH0P2yKIhS1BlQhZOzf4=\", false, function () {\n  return [useForm, useStyles];\n});\n\n_c = DialogBox;\nexport default DialogBox;\n\nvar _c;\n\n$RefreshReg$(_c, \"DialogBox\");","map":{"version":3,"sources":["/var/www/html/chat-app/game/src/game/DialogBox.js"],"names":["useCallback","useEffect","useState","makeStyles","useForm","dungAudio","saiAudio","dialogBorderBox","Message","ReactAudioPlayer","useStyles","theme","dialogWindow","width","height","multiplier","messageBoxHeight","Math","ceil","imageRendering","fontFamily","textTransform","backgroundColor","border","borderImage","padding","position","top","left","transform","minHeight","dialogTitle","fontSize","marginBottom","fontWeight","dialogFooter","cursor","textAlign","right","bottom","buttonSubmit","marginLeft","input","DialogBox","messages","characterName","onDone","gameSize","setHeroCoins","question","setHeroHealthStates","setQuestionIndex","heroHealthStates","register","handleSubmit","currentMessage","setCurrentMessage","messageEnded","setMessageEnded","forceShowFullMessage","setForceShowFullMessage","results","setResults","urlAudio","setUrlAudio","classes","onSubmit","data","textInput","toLowerCase","answer","pre","handleClick","length","handleKeyPressed","e","includes","code","window","addEventListener","removeEventListener","filter","item","i","display","action","message","marginTop"],"mappings":"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","sourcesContent":["import { useCallback, useEffect, useState } from \"react\";\nimport { makeStyles } from \"@material-ui/core/styles\";\nimport { useForm } from \"react-hook-form\";\nimport dungAudio from \"./assets/audio/dung.mp3\";\nimport saiAudio from \"./assets/audio/sai.wav\";\n\n// Images\nimport dialogBorderBox from \"./assets/images/dialog_borderbox.png\";\n\n// Components\nimport Message from \"./Message\";\nimport ReactAudioPlayer from \"react-audio-player\";\n\nconst useStyles = makeStyles((theme) => ({\n  dialogWindow: ({ width, height, multiplier }) => {\n    const messageBoxHeight = Math.ceil((height / 3.5) * multiplier);\n    return {\n      imageRendering: \"pixelated\",\n      fontFamily: '\"Press Start 2P\"',\n      textTransform: \"uppercase\",\n      backgroundColor: \"#e2b27e\",\n      border: \"solid\",\n      borderImage: `url(\"${dialogBorderBox}\") 6 / ${6 * multiplier}px ${\n        6 * multiplier\n      }px ${6 * multiplier}px ${6 * multiplier}px stretch`,\n      padding: `${8 * multiplier}px`,\n      position: \"absolute\",\n      top: `${Math.ceil(\n        height * multiplier - (messageBoxHeight + messageBoxHeight * 0.1) - 50\n      )}px`,\n      width: `${Math.ceil(width * 0.8 * multiplier)}px`,\n      left: \"50%\",\n      transform: \"translate(-50%, 0%)\",\n      minHeight: `${messageBoxHeight}px`,\n    };\n  },\n  dialogTitle: ({ multiplier }) => ({\n    fontSize: `${8 * multiplier}px`,\n    marginBottom: `${6 * multiplier}px`,\n    fontWeight: \"bold\",\n  }),\n  dialogFooter: ({ multiplier }) => ({\n    fontSize: `${8 * multiplier}px`,\n    cursor: \"pointer\",\n    textAlign: \"end\",\n    position: \"absolute\",\n    right: `${6 * multiplier}px`,\n    bottom: `${6 * multiplier}px`,\n  }),\n  buttonSubmit: ({ multiplier }) => ({\n    fontSize: `${8 * multiplier}px`,\n    marginLeft: \"20px\",\n  }),\n  input: ({ multiplier }) => ({\n    fontSize: `${8 * multiplier}px`,\n  }),\n}));\n\nconst DialogBox = ({\n  messages,\n  characterName,\n  onDone,\n  gameSize,\n  setHeroCoins,\n  question,\n  setHeroHealthStates,\n  setQuestionIndex,\n  heroHealthStates,\n}) => {\n  const { register, handleSubmit } = useForm();\n  const { width, height, multiplier } = gameSize;\n\n  const [currentMessage, setCurrentMessage] = useState(0);\n  const [messageEnded, setMessageEnded] = useState(false);\n  const [forceShowFullMessage, setForceShowFullMessage] = useState(false);\n  const [results, setResults] = useState(\"\");\n  const [urlAudio, setUrlAudio] = useState(\"\");\n  const classes = useStyles({\n    width,\n    height,\n    multiplier,\n  });\n\n  const onSubmit = (data) => {\n    const input = data.textInput.toLowerCase();\n    if (input === messages[0].answer) {\n      setHeroCoins((pre) => pre + 5);\n      setUrlAudio(dungAudio);\n      setResults(\"Đúng rồi\");\n    } else {\n      setUrlAudio(saiAudio);\n      setHeroCoins((pre) => pre - 5);\n      setResults(\"Sai rồi\");\n    }\n  };\n\n  const handleClick = useCallback(() => {\n    if (characterName === question) {\n      if (messageEnded) {\n        setMessageEnded(false);\n        setForceShowFullMessage(false);\n        if (currentMessage < messages.length - 1) {\n          setCurrentMessage(currentMessage + 1);\n        } else {\n          setCurrentMessage(0);\n          onDone();\n          setQuestionIndex((pre) => pre + 1);\n        }\n      } else {\n        setMessageEnded(true);\n        setForceShowFullMessage(true);\n      }\n    } else {\n      onDone();\n    }\n  }, [currentMessage, messageEnded, messages.length, onDone]);\n\n  useEffect(() => {\n    const handleKeyPressed = (e) => {\n      if ([\"Space\", \"Escape\"].includes(e.code)) {\n        handleClick();\n      }\n    };\n    window.addEventListener(\"keydown\", handleKeyPressed);\n\n    return () => window.removeEventListener(\"keydown\", handleKeyPressed);\n  }, [handleClick]);\n\n  useEffect(() => {\n    if (characterName !== question) {\n      setHeroHealthStates(\n        heroHealthStates.filter((item, i) => i !== heroHealthStates.length - 1)\n      );\n      setUrlAudio(saiAudio);\n    } else {\n      setHeroCoins((pre) => pre + 5);\n      // setUrlAudio(dungAudio);\n    }\n  }, []);\n\n  return (\n    <div className={classes.dialogWindow}>\n      <ReactAudioPlayer\n        src={urlAudio}\n        autoPlay\n        controls\n        style={{ display: \"none\" }}\n      />\n      <div className={classes.dialogTitle}>Quả gì?</div>\n      {characterName === question ? (\n        <>\n          <Message\n            action={messages[currentMessage].action}\n            message={messages[currentMessage].message}\n            key={currentMessage}\n            multiplier={multiplier}\n            forceShowFullMessage={forceShowFullMessage}\n            onMessageEnded={() => {\n              setMessageEnded(true);\n            }}\n          />\n          {!results ? (\n            <form onSubmit={handleSubmit(onSubmit)}>\n              <div style={{ marginTop: \"30px\" }}>\n                <input\n                  type=\"text\"\n                  {...register(\"textInput\")}\n                  placeholder=\"Nhập từ vừa nghe được\"\n                  className={classes.input}\n                />\n                <button type=\"submit\" className={classes.buttonSubmit}>\n                  Kiểm tra\n                </button>\n              </div>\n            </form>\n          ) : (\n            <div>{results}</div>\n          )}\n        </>\n      ) : (\n        <div>Bạn đã chọn sai</div>\n      )}\n      <div onClick={handleClick} className={classes.dialogFooter}>\n        Bỏ qua\n        {/* {currentMessage === messages.length - 1 && messageEnded\n          ? \"Bỏ qua\"\n          : \"Next\"} */}\n      </div>\n    </div>\n  );\n};\n\nexport default DialogBox;\n"]},"metadata":{},"sourceType":"module"}